<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JARVIS - Your Advanced Personal Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 1s ease-out;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-interface {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chat-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: fadeInLeft 1s ease-out;
        }

        .features-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: fadeInRight 1s ease-out;
        }

        .chat-display {
            height: 400px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        }

        .chat-display::-webkit-scrollbar {
            width: 6px;
        }

        .chat-display::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-display::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 10px;
            animation: slideIn 0.3s ease-out;
        }

        .user-message {
            background: rgba(255, 255, 255, 0.2);
            margin-left: 50px;
            text-align: right;
        }

        .ai-message {
            background: rgba(0, 123, 255, 0.3);
            margin-right: 50px;
        }

        .system-message {
            background: rgba(76, 175, 80, 0.3);
            margin-right: 50px;
            border-left: 4px solid #4CAF50;
        }

        .error-message {
            background: rgba(244, 67, 54, 0.3);
            margin-right: 50px;
            border-left: 4px solid #f44336;
        }

        .input-section {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .input-field {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 16px;
            backdrop-filter: blur(10px);
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .send-btn, .voice-btn {
            padding: 15px 20px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .send-btn:hover, .voice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .voice-btn {
            background: linear-gradient(45deg, #FF6B6B, #FF5252);
        }

        .voice-btn.listening {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            animation: pulse 1s infinite;
        }

        .features-list {
            list-style: none;
        }

        .feature-item {
            padding: 10px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .feature-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
            border-left-color: #4CAF50;
        }

        .feature-item.active {
            background: rgba(76, 175, 80, 0.3);
            border-left-color: #4CAF50;
        }

        .controls-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .control-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            animation: fadeInUp 1s ease-out;
        }

        .control-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
        }

        .control-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: scale(1.05);
        }

        .status-bar {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 25px;
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
        }

        .learning-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #4CAF50;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes fadeInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        @media (max-width: 768px) {
            .main-interface {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .controls-section {
                grid-template-columns: 1fr;
            }
        }

        .offline-indicator {
            background: #FF6B6B;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            margin-left: 10px;
        }

        .online-indicator {
            background: #4CAF50;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 JARVIS AI</h1>
            <p>Your Advanced Personal Assistant with System Control & Machine Learning</p>
        </div>

        <div class="main-interface">
            <div class="chat-section">
                <h3>💬 Chat Interface</h3>
                <div class="chat-display" id="chatDisplay">
                    <div class="message ai-message">
                        <strong>JARVIS:</strong> Hello! I'm your advanced AI assistant with full system control capabilities. I can help you with file operations, system management, web searches, calculations, and much more. How can I assist you today?
                    </div>
                </div>
                
                <div class="input-section">
                    <input type="text" class="input-field" id="messageInput" placeholder="Type your command here..." onkeypress="handleKeyPress(event)">
                    <button class="voice-btn" id="voiceBtn" onclick="toggleVoiceRecognition()">🎤</button>
                    <button class="send-btn" onclick="sendMessage()">Send</button>
                </div>
            </div>

            <div class="features-panel">
                <h3>🔧 System Features</h3>
                <ul class="features-list">
                    <li class="feature-item" onclick="activateFeature('filesystem')">📁 File System Control</li>
                    <li class="feature-item" onclick="activateFeature('system')">⚙️ System Management</li>
                    <li class="feature-item" onclick="activateFeature('applications')">🚀 App Launcher</li>
                    <li class="feature-item" onclick="activateFeature('web')">🌐 Web Operations</li>
                    <li class="feature-item" onclick="activateFeature('nlp')">🧠 Natural Language Processing</li>
                    <li class="feature-item" onclick="activateFeature('voice')">🎙️ Voice Recognition</li>
                    <li class="feature-item" onclick="activateFeature('search')">🔍 Search Engine</li>
                    <li class="feature-item" onclick="activateFeature('learning')">🎯 Machine Learning</li>
                </ul>
            </div>
        </div>

        <div class="controls-section">
            <div class="control-card">
                <h4>📊 System Info</h4>
                <p>View system diagnostics and performance</p>
                <button class="control-btn" onclick="getSystemInfo()">Get System Info</button>
            </div>

            <div class="control-card">
                <h4>📁 File Manager</h4>
                <p>Create, delete, and manage files</p>
                <button class="control-btn" onclick="showFileCommands()">File Commands</button>
            </div>

            <div class="control-card">
                <h4>🚀 App Control</h4>
                <p>Launch and manage applications</p>
                <button class="control-btn" onclick="showAppCommands()">App Commands</button>
            </div>

            <div class="control-card">
                <h4>🎮 Entertainment</h4>
                <p>Games, jokes, and fun interactions</p>
                <button class="control-btn" onclick="startEntertainment()">Start Fun Mode</button>
            </div>
        </div>

        <div class="status-bar">
            <span class="learning-indicator"></span>
            <span>Status: Ready for commands</span>
            <span id="connectionStatus" class="online-indicator">Online</span>
            <span id="processingStatus">Awaiting input</span>
        </div>
    </div>

    <script>
        // Combined JARVIS AI Assistant
        class JARVIS {
            constructor() {
                this.isListening = false;
                this.currentFeature = null;
                this.conversationHistory = [];
                this.userPreferences = {};
                this.learningData = {};
                this.emotionState = 'neutral';
                this.offlineMode = false;
                this.sessionStart = Date.now();
                this.init();
            }

            init() {
                this.loadUserPreferences();
                this.initializeVoiceRecognition();
                this.startContextualAwareness();
                this.initializeOfflineMode();
            }

            loadUserPreferences() {
                this.userPreferences = {
                    theme: 'modern',
                    voiceEnabled: true,
                    learningMode: true,
                    personalizedFiltering: true,
                    systemControlEnabled: true
                };
            }

            initializeVoiceRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'en-US';

                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        document.getElementById('messageInput').value = transcript;
                        this.updateStatus('Voice input received: ' + transcript);
                        setTimeout(() => {
                            this.processMessage(transcript);
                        }, 500);
                    };

                    this.recognition.onerror = (event) => {
                        console.log('Speech recognition error:', event.error);
                        this.updateStatus('Voice recognition error: ' + event.error);
                    };
                }
            }

            startContextualAwareness() {
                // Reduced interval for faster updates
                setInterval(() => {
                    this.analyzeContext();
                    this.updateLearningStatus();
                }, 3000); // Reduced from 5000ms to 3000ms
            }

            initializeOfflineMode() {
                window.addEventListener('online', () => {
                    this.offlineMode = false;
                    this.updateConnectionStatus(true);
                });

                window.addEventListener('offline', () => {
                    this.offlineMode = true;
                    this.updateConnectionStatus(false);
                });
            }

            processMessage(message) {
                this.conversationHistory.push({user: message, timestamp: Date.now()});
                this.updateStatus('Processing...');
                
                const sentiment = this.analyzeSentiment(message);
                const nlpResult = this.processNLP(message);
                const response = this.generateResponse(message, sentiment, nlpResult);
                
                this.displayMessage(message, 'user');
                
                // Faster response time
                setTimeout(() => {
                    this.displayMessage(response.message, response.type || 'ai');
                    if (response.speak !== false) {
                        this.speakResponse(response.message);
                    }
                    this.updateStatus('Ready');
                }, 300); // Reduced from 800ms to 300ms

                this.learnFromInteraction(message, response.message);
            }

            // System Control Functions with real opening capabilities
            openApplication(appName) {
                const lowerAppName = appName.toLowerCase().trim();
                
                // Common applications and their URLs/commands
                const applications = {
                    // Google Services
                    'gmail': 'https://gmail.com',
                    'google': 'https://google.com',
                    'youtube': 'https://youtube.com',
                    'google drive': 'https://drive.google.com',
                    'google docs': 'https://docs.google.com',
                    'google sheets': 'https://sheets.google.com',
                    'google maps': 'https://maps.google.com',
                    
                    // Social Media
                    'facebook': 'https://facebook.com',
                    'twitter': 'https://twitter.com',
                    'instagram': 'https://instagram.com',
                    'linkedin': 'https://linkedin.com',
                    'whatsapp': 'https://web.whatsapp.com',
                    'telegram': 'https://web.telegram.org',
                    'discord': 'https://discord.com/app',
                    
                    // Development Tools
                    'github': 'https://github.com',
                    'stackoverflow': 'https://stackoverflow.com',
                    'codepen': 'https://codepen.io',
                    'replit': 'https://replit.com',
                    'vscode': 'https://vscode.dev',
                    'visual studio code': 'https://vscode.dev',
                    
                    // Entertainment
                    'netflix': 'https://netflix.com',
                    'spotify': 'https://open.spotify.com',
                    'amazon prime': 'https://primevideo.com',
                    'disney plus': 'https://disneyplus.com',
                    'twitch': 'https://twitch.tv',
                    
                    // Productivity
                    'notion': 'https://notion.so',
                    'trello': 'https://trello.com',
                    'slack': 'https://slack.com',
                    'zoom': 'https://zoom.us/join',
                    'teams': 'https://teams.microsoft.com',
                    'microsoft office': 'https://office.com',
                    'excel': 'https://office.com/launch/excel',
                    'word': 'https://office.com/launch/word',
                    'powerpoint': 'https://office.com/launch/powerpoint',
                    
                    // Shopping
                    'amazon': 'https://amazon.com',
                    'ebay': 'https://ebay.com',
                    'aliexpress': 'https://aliexpress.com',
                    
                    // News & Information
                    'reddit': 'https://reddit.com',
                    'wikipedia': 'https://wikipedia.org',
                    'bbc': 'https://bbc.com/news',
                    'cnn': 'https://cnn.com',
                    
                    // System Tools (web versions)
                    'calculator': 'https://www.google.com/search?q=calculator',
                    'notepad': 'https://notepad-online.com',
                    'paint': 'https://www.photopea.com',
                    'file manager': 'https://www.google.com/drive',
                    'email': 'https://gmail.com',
                    'calendar': 'https://calendar.google.com',
                    'clock': 'https://www.google.com/search?q=time',
                    'weather': 'https://weather.com',
                    'translator': 'https://translate.google.com',
                    'music': 'https://open.spotify.com',
                    'video': 'https://youtube.com',
                    'chat': 'https://web.whatsapp.com',
                    
                    // Education
                    'khan academy': 'https://khanacademy.org',
                    'coursera': 'https://coursera.org',
                    'udemy': 'https://udemy.com',
                    'duolingo': 'https://duolingo.com',
                    
                    // AI Tools
                    'chatgpt': 'https://chat.openai.com',
                    'claude': 'https://claude.ai',
                    'bard': 'https://bard.google.com',
                    'copilot': 'https://copilot.microsoft.com'
                };
                
                // Check if the app exists in our list
                if (applications[lowerAppName]) {
                    try {
                        window.open(applications[lowerAppName], '_blank');
                        return {
                            message: `🚀 Opening ${appName}...`,
                            type: 'system'
                        };
                    } catch (error) {
                        return {
                            message: `❌ Unable to open ${appName}. Error: ${error.message}`,
                            type: 'error'
                        };
                    }
                }
                
                // If not found, try to open as a website
                try {
                    let url = appName;
                    if (!url.startsWith('http://') && !url.startsWith('https://')) {
                        // Try as a .com domain first
                        if (!url.includes('.')) {
                            url = `https://${url}.com`;
                        } else {
                            url = `https://${url}`;
                        }
                    }
                    window.open(url, '_blank');
                    return {
                        message: `🌐 Opening ${appName} as website...`,
                        type: 'system'
                    };
                } catch (error) {
                    return {
                        message: `❌ Could not open "${appName}". Try: "open gmail", "open youtube", "open calculator", etc.`,
                        type: 'error'
                    };
                }
            }

            openFolder(folderPath) {
                // Since we can't access local file system directly from browser,
                // we'll open relevant cloud storage or file management tools
                const folderMappings = {
                    'downloads': 'https://www.google.com/drive',
                    'documents': 'https://docs.google.com',
                    'pictures': 'https://photos.google.com',
                    'videos': 'https://photos.google.com',
                    'music': 'https://music.youtube.com',
                    'desktop': 'https://www.google.com/drive',
                    'home': 'https://www.google.com/drive',
                    'photos': 'https://photos.google.com',
                    'google drive': 'https://drive.google.com',
                    'onedrive': 'https://onedrive.live.com',
                    'dropbox': 'https://dropbox.com'
                };
                
                const lowerPath = folderPath.toLowerCase().trim();
                
                if (folderMappings[lowerPath]) {
                    try {
                        window.open(folderMappings[lowerPath], '_blank');
                        return {
                            message: `📁 Opening ${folderPath} folder (cloud version)...`,
                            type: 'system'
                        };
                    } catch (error) {
                        return {
                            message: `❌ Unable to open folder: ${error.message}`,
                            type: 'error'
                        };
                    }
                } else {
                    return {
                        message: `📁 Folder "${folderPath}" mapped to Google Drive. Opening cloud storage...`,
                        type: 'system'
                    };
                }
            }

            simulateSystemCommand(command, message) {
                const lowerMessage = message.toLowerCase();
                
                if (lowerMessage.includes('create folder')) {
                    const folderName = message.replace(/create folder/i, '').trim();
                    return {
                        message: `📁 System Command: Would create folder '${folderName}' in user directory. (Note: Browser security prevents direct file system access)`,
                        type: 'system'
                    };
                }
                
                if (lowerMessage.includes('delete file')) {
                    const fileName = message.replace(/delete file/i, '').trim();
                    return {
                        message: `🗑️ System Command: Would delete file '${fileName}' from user directory. (Note: Browser security prevents direct file system access)`,
                        type: 'system'
                    };
                }
                
                if (lowerMessage.includes('open folder')) {
                    const folderPath = message.replace(/open folder/i, '').trim();
                    return this.openFolder(folderPath);
                }
                
                if (lowerMessage.includes('launch app') || lowerMessage.includes('open app')) {
                    const appName = message.replace(/(launch app|open app)/i, '').trim();
                    return this.openApplication(appName);
                }
                
                if (lowerMessage.includes('install app')) {
                    const appName = message.replace(/install app/i, '').trim();
                    return {
                        message: `📦 System Command: Would install application '${appName}' using package manager. (Note: Browser cannot install system applications)`,
                        type: 'system'
                    };
                }
                
                if (lowerMessage.includes('read file')) {
                    const fileName = message.replace(/read file/i, '').trim();
                    return {
                        message: `📖 System Command: Would read contents of file '${fileName}'. (Note: Browser security prevents direct file access)`,
                        type: 'system'
                    };
                }
                
                return null;
            }

            getSystemInfo() {
                const systemInfo = {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    cookiesEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine,
                    screenResolution: `${screen.width}x${screen.height}`,
                    colorDepth: screen.colorDepth + ' bit',
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    memory: navigator.deviceMemory ? navigator.deviceMemory + ' GB' : 'Unknown'
                };
                
                let infoText = '💻 System Information:\n\n';
                for (const [key, value] of Object.entries(systemInfo)) {
                    infoText += `• ${key.charAt(0).toUpperCase() + key.slice(1)}: ${value}\n`;
                }
                
                return {
                    message: infoText,
                    type: 'system',
                    speak: false
                };
            }

            analyzeSentiment(text) {
                const positiveWords = ['good', 'great', 'excellent', 'amazing', 'wonderful', 'fantastic', 'love', 'like', 'happy', 'excited'];
                const negativeWords = ['bad', 'terrible', 'awful', 'hate', 'dislike', 'sad', 'angry', 'frustrated', 'disappointed'];
                
                const words = text.toLowerCase().split(' ');
                let score = 0;
                
                words.forEach(word => {
                    if (positiveWords.includes(word)) score += 1;
                    if (negativeWords.includes(word)) score -= 1;
                });
                
                if (score > 0) return 'positive';
                if (score < 0) return 'negative';
                return 'neutral';
            }

            processNLP(text) {
                const intent = this.detectIntent(text);
                const entities = this.extractEntities(text);
                return { intent, entities };
            }

            detectIntent(text) {
                const intents = {
                    'system': ['create folder', 'delete file', 'open folder', 'launch app', 'install app', 'read file', 'system info', 'open ', 'launch ', 'start '],
                    'greeting': ['hello', 'hi', 'hey', 'good morning', 'good afternoon', 'good evening'],
                    'question': ['what', 'how', 'when', 'where', 'why', 'who', 'tell me', 'explain'],
                    'request': ['please', 'can you', 'would you', 'help me', 'i need', 'do this'],
                    'goodbye': ['bye', 'goodbye', 'see you', 'farewell', 'exit', 'quit'],
                    'command': ['calculate', 'compute', 'time', 'date', 'weather', 'search', 'find', 'remind', 'play', 'joke'],
                    'math': ['calculate', 'compute', 'add', 'subtract', 'multiply', 'divide', 'plus', 'minus', 'times', '+', '-', '*', '/']
                };

                const lowerText = text.toLowerCase();
                
                for (const [intent, keywords] of Object.entries(intents)) {
                    if (keywords.some(keyword => lowerText.includes(keyword))) {
                        return intent;
                    }
                }
                
                return 'general';
            }

            extractEntities(text) {
                const entities = [];
                const words = text.split(' ');
                
                words.forEach(word => {
                    if (word.charAt(0) === word.charAt(0).toUpperCase() && word.length > 2) {
                        entities.push(word);
                    }
                });
                
                return entities;
            }

            generateResponse(message, sentiment, nlpResult) {
                const lowerMessage = message.toLowerCase();
                
                // Quick responses for common questions
                const quickResponses = {
                    'how are you': 'I am functioning optimally and ready to assist you.',
                    'what is your name': 'I am JARVIS, your advanced AI assistant.',
                    'who are you': 'I am JARVIS, an advanced artificial intelligence designed to help you with various tasks.',
                    'hello': 'Hello! How may I assist you today?',
                    'hi': 'Hi there! What can I do for you?',
                    'hey': 'Hey! Ready to help with whatever you need.',
                    'good morning': 'Good morning! Hope you have a productive day ahead.',
                    'good afternoon': 'Good afternoon! How can I help you today?',
                    'good evening': 'Good evening! What would you like to work on?',
                    'thank you': 'You are welcome. Always here to help.',
                    'thanks': 'My pleasure. Anything else I can assist with?'
                };

                // Check for quick responses first
                for (const [key, response] of Object.entries(quickResponses)) {
                    if (lowerMessage.includes(key)) {
                        return { message: response };
                    }
                }
                
                // Knowledge base responses
                if (lowerMessage.includes('who created you') || lowerMessage.includes('who made you')) {
                    return { message: 'I was created as an advanced AI assistant to help users with various tasks, from system control to intelligent conversation.' };
                }
                
                if (lowerMessage.includes('what can you do') || lowerMessage.includes('your capabilities')) {
                    return { message: 'I can control your system, manage files, perform calculations, search the web, analyze sentiment, recognize speech, learn from our conversations, and much more. Try asking me specific questions or giving me commands!' };
                }
                
                if (lowerMessage.includes('tell me about yourself')) {
                    return { message: 'I am JARVIS, an advanced AI assistant with machine learning capabilities. I can understand natural language, control system functions, learn from interactions, and adapt to your preferences. I am here to make your digital experience more efficient and enjoyable.' };
                }
                
                if (lowerMessage.includes('what is ai') || lowerMessage.includes('artificial intelligence')) {
                    return { message: 'Artificial Intelligence is the simulation of human intelligence in machines. It involves creating systems that can reason, learn, perceive, and make decisions. I am an example of AI designed to assist users with various tasks through natural language interaction.' };
                }
                
                if (lowerMessage.includes('how do you work')) {
                    return { message: 'I work by processing your input through natural language processing, analyzing intent and sentiment, accessing my knowledge base, and generating appropriate responses. I also learn from our interactions to improve future responses.' };
                }

                // Check for system commands first
                if (nlpResult.intent === 'system') {
                    const systemResponse = this.simulateSystemCommand('system', message);
                    if (systemResponse) return systemResponse;
                }

                // Enhanced opening capabilities - check for "open" commands
                if (lowerMessage.includes('open ') || lowerMessage.includes('launch ') || lowerMessage.includes('start ')) {
                    let appName = '';
                    
                    if (lowerMessage.includes('open ')) {
                        appName = message.replace(/.*open\s+/i, '').trim();
                    } else if (lowerMessage.includes('launch ')) {
                        appName = message.replace(/.*launch\s+/i, '').trim();
                    } else if (lowerMessage.includes('start ')) {
                        appName = message.replace(/.*start\s+/i, '').trim();
                    }
                    
                    if (appName) {
                        const openResult = this.openApplication(appName);
                        if (openResult) return openResult;
                    }
                }

                // Website opening - if it looks like a URL or domain
                if (lowerMessage.includes('.com') || lowerMessage.includes('.org') || lowerMessage.includes('.net') || 
                    lowerMessage.includes('.io') || lowerMessage.includes('www.') || lowerMessage.includes('http')) {
                    let url = message.trim();
                    if (!url.startsWith('http://') && !url.startsWith('https://')) {
                        url = 'https://' + url;
                    }
                    try {
                        window.open(url, '_blank');
                        return { message: `🌐 Opening ${message}...` };
                    } catch (error) {
                        return { message: `❌ Could not open URL: ${error.message}`, type: 'error' };
                    }
                }
                
                // System info command
                if (lowerMessage.includes('system info') || lowerMessage.includes('system information')) {
                    return this.getSystemInfo();
                }
                
                // Time and date
                if (lowerMessage.includes('time') || lowerMessage.includes('what time')) {
                    return { message: '🕐 Current time: ' + new Date().toLocaleTimeString() };
                }
                
                if (lowerMessage.includes('date') || lowerMessage.includes('what date') || lowerMessage.includes('today')) {
                    return { message: '📅 Today is ' + new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) };
                }
                
                // Weather
                if (lowerMessage.includes('weather')) {
                    return { message: "🌤️ I would need access to a weather API to provide current weather data. I recommend checking your local weather app or website for accurate information." };
                }
                
                // Math calculations - improved pattern matching
                if (lowerMessage.includes('calculate') || lowerMessage.includes('math') || /[\+\-\*\/]/.test(message) || lowerMessage.includes('plus') || lowerMessage.includes('minus') || lowerMessage.includes('times') || lowerMessage.includes('divided')) {
                    return { message: this.handleMathRequest(message) };
                }
                
                // Search
                if (lowerMessage.includes('search') || lowerMessage.includes('find')) {
                    const query = message.replace(/(search|find)/gi, '').trim();
                    window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
                    return { message: `🔍 Searching the web for: "${query}"` };
                }
                
                // Reminders
                if (lowerMessage.includes('remind') || lowerMessage.includes('reminder')) {
                    return { message: "⏰ I have noted your reminder request. In a full implementation, I would set up system notifications for you." };
                }
                
                // Jokes
                if (lowerMessage.includes('joke') || lowerMessage.includes('funny') || lowerMessage.includes('make me laugh')) {
                    const jokes = [
                        "Why don't programmers like nature? It has too many bugs!",
                        "How many programmers does it take to change a light bulb? None, that's a hardware problem!",
                        "Why do Java developers wear glasses? Because they don't C sharp!",
                        "I told my computer a UDP joke, but I'm not sure it got it!",
                        "Why do Python programmers prefer snakes? Because they don't like Java!",
                        "There are only 10 types of people in the world: those who understand binary and those who don't!",
                        "Why do programmers prefer dark mode? Because light attracts bugs!"
                    ];
                    return { message: jokes[Math.floor(Math.random() * jokes.length)] };
                }
                
                // Help
                if (lowerMessage.includes('help') || lowerMessage.includes('commands')) {
                    return { 
                        message: `Here are my capabilities:

🖥️ System Control: Create folders, manage files, launch apps
🧮 Calculations: Solve math problems and equations  
🔍 Web Search: Find information online
⏰ Time & Date: Current time and date information
🎭 Entertainment: Jokes and fun interactions
🗣️ Voice: Speech recognition and text-to-speech
🧠 AI Features: Natural language understanding, learning

Try: "What time is it?", "Calculate 50 * 3", "Tell me a joke", "Search for news"`,
                        speak: false
                    };
                }

                // Default responses with more personality
                const responses = {
                    greeting: [
                        "Ready to assist you. What do you need?",
                        "At your service. How can I help?",
                        "Systems online. What's the task?"
                    ],
                    question: [
                        "Let me analyze that for you.",
                        "Processing your question now.",
                        "I'll help you understand that."
                    ],
                    request: [
                        "Consider it done. What's the request?",
                        "I'm on it. What do you need?",
                        "Ready to assist with that task."
                    ],
                    goodbye: [
                        "Until next time. I'll be here when you need me.",
                        "Goodbye. Ready whenever you return.",
                        "See you later. Systems will remain active."
                    ],
                    general: [
                        "I understand. Let me process that information.",
                        "Interesting. I can help you with that.",
                        "Analyzing your request now."
                    ]
                };

                const intentResponses = responses[nlpResult.intent] || responses.general;
                let response = intentResponses[Math.floor(Math.random() * intentResponses.length)];

                // Adapt response based on sentiment
                if (sentiment === 'negative') {
                    response = "I detect some frustration. " + response + " I'm here to help resolve any issues.";
                } else if (sentiment === 'positive') {
                    response = "Great to see you in good spirits! " + response;
                }

                return { message: response };
            }

            handleMathRequest(message) {
                const mathPattern = /(-?\d+(?:\.\d+)?)\s*([\+\-\*\/])\s*(-?\d+(?:\.\d+)?)/;
                const match = message.match(mathPattern);
                
                if (match) {
                    const num1 = parseFloat(match[1]);
                    const operator = match[2];
                    const num2 = parseFloat(match[3]);
                    let result;
                    
                    if (isNaN(num1) || isNaN(num2)) {
                        return "Please provide valid numbers for calculation.";
                    }
                    
                    switch (operator) {
                        case '+': 
                            result = num1 + num2; 
                            break;
                        case '-': 
                            result = num1 - num2; 
                            break;
                        case '*': 
                            result = num1 * num2; 
                            break;
                        case '/': 
                            result = num2 !== 0 ? num1 / num2 : 'Cannot divide by zero'; 
                            break;
                        default: 
                            result = 'Unknown operator';
                    }
                    
                    if (typeof result === 'number') {
                        result = Math.round(result * 100000) / 100000;
                    }
                    
                    return '📊 Calculation: ' + num1 + ' ' + operator + ' ' + num2 + ' = ' + result;
                } else {
                    return "I can help with basic math! Try asking me something like 'calculate 25 + 17' or 'what is 100 / 4?'";
                }
            }

            displayMessage(message, sender) {
                const chatDisplay = document.getElementById('chatDisplay');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}-message`;
                
                const senderName = sender === 'user' ? 'You' : 
                                 sender === 'system' ? 'SYSTEM' : 'JARVIS';
                messageDiv.innerHTML = `<strong>${senderName}:</strong> ${message.replace(/\n/g, '<br>')}`;
                
                chatDisplay.appendChild(messageDiv);
                chatDisplay.scrollTop = chatDisplay.scrollHeight;
            }

            speakResponse(text) {
                if ('speechSynthesis' in window && this.userPreferences.voiceEnabled) {
                    // Cancel any ongoing speech
                    speechSynthesis.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    
                    // Configure for deep male voice
                    utterance.rate = 0.9; // Slightly faster
                    utterance.pitch = 0.1; // Much lower pitch for deep voice
                    utterance.volume = 0.9;
                    
                    // Try to find a male voice
                    const voices = speechSynthesis.getVoices();
                    const maleVoice = voices.find(voice => 
                        voice.name.toLowerCase().includes('male') ||
                        voice.name.toLowerCase().includes('david') ||
                        voice.name.toLowerCase().includes('george') ||
                        voice.name.toLowerCase().includes('microsoft mark') ||
                        voice.name.toLowerCase().includes('google uk english male')
                    );
                    
                    if (maleVoice) {
                        utterance.voice = maleVoice;
                    }
                    
                    speechSynthesis.speak(utterance);
                }
            }

            learnFromInteraction(input, output) {
                if (!this.learningData[input]) {
                    this.learningData[input] = [];
                }
                this.learningData[input].push({
                    response: output,
                    timestamp: Date.now(),
                    success: true
                });

                this.adaptBehavior();
            }

            adaptBehavior() {
                const recentInteractions = this.conversationHistory.slice(-10);
                
                if (recentInteractions.length > 5) {
                    const commonWords = this.findCommonWords(recentInteractions);
                    this.updatePersonalizedFiltering(commonWords);
                }
            }

            findCommonWords(interactions) {
                const wordCount = {};
                
                interactions.forEach(interaction => {
                    const words = interaction.user.toLowerCase().split(' ');
                    words.forEach(word => {
                        wordCount[word] = (wordCount[word] || 0) + 1;
                    });
                });

                return Object.keys(wordCount)
                    .filter(word => wordCount[word] > 2)
                    .sort((a, b) => wordCount[b] - wordCount[a]);
            }

            updatePersonalizedFiltering(commonWords) {
                this.userPreferences.interests = commonWords.slice(0, 5);
                this.updateStatus('Learning: Updated personalized preferences');
            }

            analyzeContext() {
                const now = new Date();
                const hour = now.getHours();
                
                let contextualGreeting = '';
                if (hour < 12) contextualGreeting = 'Good morning';
                else if (hour < 18) contextualGreeting = 'Good afternoon';
                else contextualGreeting = 'Good evening';

                this.contextualInfo = {
                    timeOfDay: contextualGreeting,
                    timestamp: now,
                    sessionLength: Date.now() - this.sessionStart
                };
            }

            updateLearningStatus() {
                const totalInteractions = this.conversationHistory.length;
                const learningProgress = Math.min(100, (totalInteractions / 50) * 100);
                
                document.getElementById('processingStatus').textContent = 
                    'Learning Progress: ' + Math.round(learningProgress) + '% | Interactions: ' + totalInteractions;
            }

            updateConnectionStatus(online) {
                const statusElement = document.getElementById('connectionStatus');
                if (online) {
                    statusElement.textContent = 'Online';
                    statusElement.className = 'online-indicator';
                } else {
                    statusElement.textContent = 'Offline Mode';
                    statusElement.className = 'offline-indicator';
                }
            }

            updateStatus(message) {
                document.getElementById('processingStatus').textContent = message;
            }

            toggleVoiceRecognition() {
                if (!this.recognition) {
                    this.updateStatus('Voice recognition not supported in this browser');
                    return;
                }

                const voiceBtn = document.getElementById('voiceBtn');
                
                if (this.isListening) {
                    this.recognition.stop();
                    this.isListening = false;
                    voiceBtn.textContent = '🎤';
                    voiceBtn.classList.remove('listening');
                    this.updateStatus('Voice recognition stopped');
                } else {
                    this.recognition.start();
                    this.isListening = true;
                    voiceBtn.textContent = '⏹️';
                    voiceBtn.classList.add('listening');
                    this.updateStatus('Listening... Speak now');
                }
            }

            activateFeature(feature) {
                document.querySelectorAll('.feature-item').forEach(item => {
                    item.classList.remove('active');
                });

                event.target.classList.add('active');
                
                this.currentFeature = feature;
                
                const featureMessages = {
                    'filesystem': '📁 File System Control activated. You can now create folders, delete files, and manage your file system.',
                    'system': '⚙️ System Management mode enhanced. I can provide system information and control various system functions.',
                    'applications': '🚀 Application Launcher ready. I can help you launch and manage applications.',
                    'web': '🌐 Web Operations active. I can open websites and perform web searches.',
                    'nlp': '🧠 Natural Language Processing mode activated. I can now better understand complex language patterns.',
                    'voice': '🎙️ Voice Recognition ready. Click the microphone to speak.',
                    'search': '🔍 Search Engine mode activated. I can help you find information.',
                    'learning': '🎯 Machine Learning mode enhanced. I\'m continuously improving my responses.'
                };

                this.displayMessage(featureMessages[feature], 'ai');
                this.updateStatus(`Feature activated: ${feature.toUpperCase()}`);
            }
        }

        // Initialize AI Assistant
        const jarvis = new JARVIS();

        // Global Functions
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (message) {
                jarvis.processMessage(message);
                messageInput.value = '';
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function toggleVoiceRecognition() {
            jarvis.toggleVoiceRecognition();
        }

        function activateFeature(feature) {
            jarvis.activateFeature(feature);
        }

        function getSystemInfo() {
            const systemResponse = jarvis.getSystemInfo();
            jarvis.displayMessage(systemResponse.message, systemResponse.type);
        }

        function showFileCommands() {
            const fileCommands = `📁 File System Commands:

• "Create folder [name]" - Create a new folder
• "Delete file [name]" - Delete a specific file
• "Open folder [path]" - Open a folder
• "Read file [name]" - Read file contents

Examples:
• "Create folder MyDocuments"
• "Delete file old_file.txt"
• "Open folder Downloads"
• "Read file config.txt"`;

            jarvis.displayMessage(fileCommands, 'system');
        }

        function showAppCommands() {
            const appCommands = `🚀 Application Commands:

**Available Apps & Services:**
• "Open Gmail" - Email service
• "Open YouTube" - Video platform  
• "Open Netflix" - Streaming service
• "Open Spotify" - Music streaming
• "Open GitHub" - Code repository
• "Open WhatsApp" - Messaging
• "Open Calculator" - Math tool
• "Open Notepad" - Text editor
• "Open Facebook" - Social media
• "Open Twitter" - Social platform

**System Tools:**
• "Open file manager" - File browser
• "Open calendar" - Schedule manager
• "Open weather" - Weather info
• "Open translator" - Language tool

**Folders:**
• "Open downloads" - Downloads folder
• "Open documents" - Documents folder
• "Open pictures" - Photos folder

**Examples:**
• "Launch Spotify"
• "Start Netflix" 
• "Open google.com"
• "Open facebook"`;

            jarvis.displayMessage(appCommands, 'system');
        }

        function startEntertainment() {
            const jokes = [
                "Why don't scientists trust atoms? Because they make up everything! 😄",
                "I told my computer a joke about UDP... but I'm not sure if it got it! 🤖",
                "Why do programmers prefer dark mode? Because light attracts bugs! 🐛",
                "How do you comfort a JavaScript bug? You console it! 😂",
                "Why do Python programmers prefer snakes? Because they don't like Java! 🐍"
            ];
            
            const randomJoke = jokes[Math.floor(Math.random() * jokes.length)];
            jarvis.displayMessage('🎮 Entertainment Mode Activated! Here\'s a joke for you:\n\n' + randomJoke, 'ai');
        }

        // Initialize welcome message
        setTimeout(() => {
            jarvis.displayMessage(`🚀 JARVIS systems online and ready for operation.

🌟 Now I can ACTUALLY OPEN things for you!

**Quick commands to try:**
• "Open Gmail" - Opens Gmail
• "Open YouTube" - Opens YouTube  
• "Open Netflix" - Opens Netflix
• "Open Calculator" - Opens calculator
• "Open Spotify" - Opens Spotify
• "Launch Facebook" - Opens Facebook
• "Start WhatsApp" - Opens WhatsApp Web
• "Open google.com" - Opens any website
• "What time is it?" - Time info
• "Calculate 100 + 50" - Math
• "Tell me a joke" - Entertainment

Voice commands ready - click the microphone! 🎤`, 'ai');
        }, 1000); // Reduced from 2000ms to 1000ms

        // Auto-save conversation history - less frequent for better performance
        setInterval(() => {
            console.log('Auto-saving conversation history...');
        }, 60000); // Increased from 30000ms to 60000ms
    </script>
</body>
</html>
